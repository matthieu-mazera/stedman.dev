<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="/assets/img/sd-32.png" sizes="32x32">
  <link rel="apple-touch-icon" type="image/png" href="/assets/img/sd-180.png" sizes="180x180">
  <link rel="icon" type="image/png" href="/assets/img/sd-192.png" sizes="192x192">
  <link rel=canonical href="https://stedman.dev/2020/05/11/watching-sass-in-eleventy/">
  <meta name="description" content="Automatically kick-off Sass builds in Eleventy development mode with this workflow.">
  <meta property="og:url" content="https://stedman.dev/2020/05/11/watching-sass-in-eleventy/">
  <meta property="og:title" content="Watching Sass in Eleventy • stedman.dev">
  <meta property="og:description" content="Automatically kick-off Sass builds in Eleventy development mode with this workflow.">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:creator" content="@stedman">
  <title>Watching Sass in Eleventy • stedman.dev</title>
  <link rel="alternate" type="application/atom+xml" href="https://stedman.dev/atom.xml" title="stedman.dev Atom feed">
  <link rel="webmention" href="https://webmention.io/stedman.dev/webmention">
  <link rel="pingback" href="https://webmention.io/stedman.dev/xmlrpc">
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="/assets/css/prism-atom-dark.css">
  <script type="module" src="https://unpkg.com/ionicons@5.0.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule="" src="https://unpkg.com/ionicons@5.0.0/dist/ionicons/ionicons.js"></script>
</head>
<body>
  <header class="page-header hero">
    <div class="hero-body is-paddingless">
      <div class="container">
        <div class="navbar" role="navigation" aria-label="main navigation">
          <div class="navbar-brand">
            <a class="navbar-item title is-size-4-tablet" href="/">
              <i class="icon site-logo">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 442 500" width="24" height="27">
                  <g fill="currentColor">
                  <path transform="rotate(180 233.39 309.77)" d="m25 2.4e2c0 1.1e2 1.9e2 2.6e2 2.5e2 2.6e2 9 0 11-5.5 11-12 0-29-1.8e2 -1.4e2 -1.8e2 -2.5e2 0-36 38-55 97-55 59 0 1.4e2 20 1.6e2 41s-2.7 66 10 74c4.7 2.6 13 5.2 20 5.2 17 0 46-71 46-1e2 0-50-1.8e2 -81-2.5e2 -81-72 0-1.7e2 16-1.7e2 1.2e2z"/>
                  <path d="m0 1.2e2c0 1.1e2 1.9e2 2.6e2 2.5e2 2.6e2 9 0 11-5.5 11-12 0-29-1.8e2 -1.4e2 -1.8e2 -2.5e2 0-36 38-55 97-55 59 0 1.4e2 20 1.6e2 41 11 21-2.7 66 10 74 4.7 2.6 13 5.2 20 5.2 17 0 46-71 46-1e2 0-50-1.8e2 -81-2.5e2 -81-72 0-1.7e2 16-1.7e2 1.2e2z"/>
                  </g>
                  </svg>
              </i>
              stedman.dev
            </a>
          </div>

          <div class="navbar-menu is-size-5">
            <div class="navbar-end">
              <a class="navbar-item" href="/">
                Home
              </a>
              <a class="navbar-item" href="/about/">
                About
              </a>
              <a class="navbar-item" href="/atom.xml">
                <span class="is-sr-only">RSS feed</span>
                <span class="icon" title="RSS feed">
                  <ion-icon class="is-size-5" src="/assets/icon/logo-rss.svg" title="RSS"></ion-icon>
                </span>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="page-main section has-background-white">
    <div class="container">
      <div class="columns">
        <div class="column is-10 is-offset-1 content is-size-5">
          
<article class="h-entry">
  <h1 class="p-name">Watching Sass in Eleventy</h1>

  <p class="is-sr-only">By <em class="p-author">Steve Stedman</em></p>

  <p class="has-text-grey is-size-6">
    <span class="is-inline-block" style="vertical-align:middle">
      <ion-icon class="is-size-6" style="fill: #b5b5b5" src="/assets/icon/today-outline.svg"></ion-icon>
    </span>
    <time class="dt-published" datetime="Mon May 11 2020 00:00:00 GMT+0000 (Coordinated Universal Time)">
      May 11, 2020
    </time>
  </p>

  <div class="e-content">
    <p>I’ve been using <a href="https://github.com/sass/node-sass">node-sass</a> in my <a href="https://11ty.dev/">11ty</a> workflow for awhile now but, for whatever reason, couldn’t get the <code>--watch</code> flag to work. This meant that, for any SCSS update, I’d have to toggle back to the command line and manually run <code>npx node-sass src/_sass/_main.scss dist/css/main.css</code> or an npm script shortcut for the same.</p>
<p>Well, I finally had enough and came up with something that works for me. It might just work for you so I’m sharing the details here.</p>
<ol>
<li>
<p>Make sure <code>node-sass</code> is installed.</p>
<pre class="language-shell"><code class="language-shell"><span class="token function">npm</span> <span class="token function">install</span> --save-dev node-sass</code></pre>
</li>
<li>
<p>Open a new file, name it <code>_includes/sass-watch.js</code>, and drop in the following code.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> sass <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'node-sass'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Generate and save CSS.</span><br><span class="token keyword">const</span> <span class="token function-variable function">generateCss</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">_scssPath<span class="token punctuation">,</span> _cssPath</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token comment">// Encapsulate rendered css from _scssPath into renderedCss variable</span><br>  <span class="token keyword">const</span> renderedCss <span class="token operator">=</span> sass<span class="token punctuation">.</span><span class="token function">renderSync</span><span class="token punctuation">(</span><span class="token punctuation">{</span> file<span class="token operator">:</span> _scssPath <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Then write result css string to _cssPath file</span><br>  fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>_cssPath<span class="token punctuation">,</span> renderedCss<span class="token punctuation">.</span>css<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">writeErr</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>writeErr<span class="token punctuation">)</span> <span class="token keyword">throw</span> writeErr<span class="token punctuation">;</span><br><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">CSS file saved: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>_cssPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">scssPath<span class="token punctuation">,</span> cssPath</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token comment">// If cssPath directory doesn't already exist, add it...</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>cssPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Creating new CSS directory: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>cssPath<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Create cssPath directory recursively</span><br>    fs<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>cssPath<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> recursive<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">mkdirErr</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>mkdirErr<span class="token punctuation">)</span> <span class="token keyword">throw</span> mkdirErr<span class="token punctuation">;</span><br><br>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'CSS directory created.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      <span class="token function">generateCss</span><span class="token punctuation">(</span>scssPath<span class="token punctuation">,</span> cssPath<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">// Generate CSS on startup</span><br>  <span class="token function">generateCss</span><span class="token punctuation">(</span>scssPath<span class="token punctuation">,</span> cssPath<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Use Node's fs.watch to catch subsequent changes to scssPath directory</span><br>  fs<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>scssPath<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">evType<span class="token punctuation">,</span> filename</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">SCSS file changed: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>scssPath<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token function">generateCss</span><span class="token punctuation">(</span>scssPath<span class="token punctuation">,</span> cssPath<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</li>
<li>
<p>Edit <code>.eleventy.js</code> so that it now includes the following <code>sass-watch</code> bits.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> sassWatch <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./_includes/sass-watch'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">eleventyConfig</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// Watch Sass directory for styling changes.</span><br>  <span class="token comment">// Works only if you set the ELEVENTY_ENV to 'dev'.</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">ELEVENTY_ENV</span> <span class="token operator">===</span> <span class="token string">'dev'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">sassWatch</span><span class="token punctuation">(</span><span class="token string">'./src/_sass/_main.scss'</span><span class="token punctuation">,</span> <span class="token string">'./dist/css/main.css'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token punctuation">.</span><span class="token punctuation">.</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>Sharp-eyed folks will notice that the script above won’t run unless there’s an <code>ELEVENTY_ENV</code> environment variable set. This is to prevent sass-watch from running in production where it isn’t needed and might just cause mischief.</p>
<p>For local development, I set the <code>ELEVENTY_ENV</code> variable to <code>dev</code> in two places but mostly rely on the VSCode debugger for daily use.</p>
<ol>
<li>
<p>Command line: <code>package.json</code> start script:</p>
<pre class="language-json"><code class="language-json"><span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"ELEVENTY_ENV=dev eleventy --serve --watch"</span></code></pre>
</li>
<li>
<p>VSCode: <code>.vscode/launch.json</code> script:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.2.0"</span><span class="token punctuation">,</span><br>  <span class="token property">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"node"</span><span class="token punctuation">,</span><br>      <span class="token property">"request"</span><span class="token operator">:</span> <span class="token string">"launch"</span><span class="token punctuation">,</span><br>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Launch 11ty"</span><span class="token punctuation">,</span><br>      <span class="token property">"program"</span><span class="token operator">:</span> <span class="token string">"${workspaceFolder}/node_modules/@11ty/eleventy/cmd.js"</span><span class="token punctuation">,</span><br>      <span class="token property">"args"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>        <span class="token string">"--serve"</span><span class="token punctuation">,</span><br>        <span class="token string">"--watch"</span><br>      <span class="token punctuation">]</span><span class="token punctuation">,</span><br>      <span class="token property">"env"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>        <span class="token property">"ELEVENTY_ENV"</span><span class="token operator">:</span> <span class="token string">"dev"</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre>
</li>
</ol>
</li>
<li>
<p>Start Eleventy again via command line (<code>npm start</code>) or VSCode via the Debugger, all subsequent changes to Sass files should initiate an automatic build and the browser should refresh with the changes.</p>
</li>
</ol>
<h2 id="conclusion">Conclusion <a class="anchor-link" href="#conclusion">permalink</a></h2>
<p>I sincerely hope there’s a better solution for kicking-off Sass builds from file changes. If you can enlighten me, please reach out on <a href="https://twitter.com/stedman">Twitter @stedman</a>.</p>
<p>Until then, I’ll be happily updating Sass and watching the changes show up in my browser.</p>

  </div>
</article>

        </div>
      </div>
    </div>
  </main>

  <footer class="page-footer footer has-offset-top">
    <div class="container">
      <div class="navbar">
        <div class="navbar-menu is-active">
          <div class="navbar-start">
            <span class="navbar-item is-inline-block-tablet">
              &copy; 2020
              <a class="h-card" rel="me" href="https://stedman.dev/">
                Steve Stedman
              </a>
            </span>
            <a class="navbar-item is-sr-only-desktop is-inline-block" href="/">
              Home
            </a>
            <a class="navbar-item is-sr-only-desktop is-inline-block" href="/about/">
              About
            </a>
            <a class="navbar-item is-sr-only-desktop is-inline-block" href="/atom.xml">
              RSS
            </a>
          </div>
          <div class="navbar-end">
            <a class="navbar-item is-inline-block-tablet tooltip" href="https://linkedin.com/in/sstedman" rel="me" title="&ldquo;sstedman&rdquo; on LinkedIn">
              <span class="icon">
                <ion-icon src="/assets/icon/logo-linkedin.svg" title="LinkedIn"></ion-icon>
              </span>
              LinkedIn
            </a>
            <a class="navbar-item is-inline-block-tablet tooltip" href="https://twitter.com/stedman" rel="me" title="&ldquo;@stedman&rdquo; on Twitter">
              <span class="icon">
                <ion-icon src="/assets/icon/logo-twitter.svg" title="Twitter"></ion-icon>
              </span>
              Twitter
            </a>
            <a class="navbar-item is-inline-block-tablet tooltip" href="https://github.com/stedman" rel="me authn" title="&ldquo;stedman&rdquo; on GitHub">
              <span class="icon">
                <ion-icon src="/assets/icon/logo-github.svg" title="GitHub"></ion-icon>
              </span>
              GitHub
            </a>
          </div>
        </div>
      </div>
      <p class="has-text-centered is-size-7 is-italic mt-5">
        Powered by <a href="https://11ty.dev/">Eleventy</a>. See <a href="/about/#colophon">Colophon</a> for more details.
      </p>
      <p class="has-text-centered is-size-7 is-italic">
        View <a href="https://github.com/stedman/stedman.dev/blob/master/./src/_posts/2020-05-11-watching-sass-in-11ty.md">
          page source on GitHub.
        </a>
      </p>
    </div>
  </footer><!-- Web-Stat code v7.0 -->
  <span id="wts1975337"></span><script>if(location.search!=='?notrack'){var wts7={invisible:'yes'};var wts=document.createElement('script');wts.async=true;wts.src='https://wts.one/log7.js';document.head.appendChild(wts);wts.onload=function(){wtslog7(1975337,1);};}</script><noscript><a href="https://www.web-stat.com"><img src="https://wts.one/7/1/1975337.png" alt="Web-Stat site statistics"></a></noscript></body>
</html>
